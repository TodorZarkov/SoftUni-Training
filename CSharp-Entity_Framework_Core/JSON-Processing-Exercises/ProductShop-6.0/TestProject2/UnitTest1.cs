//ReSharper disable InconsistentNaming, CheckNamespace

using System;
using System.Collections.Generic;
using System.Linq;
using System.Reflection;
using System.Xml;
using AutoMapper;
using Microsoft.EntityFrameworkCore;
using Microsoft.Extensions.DependencyInjection;
using Newtonsoft.Json;
using Newtonsoft.Json.Linq;
using NUnit.Framework;
using ProductShop;
using ProductShop.Data;
using ProductShop.Models;

[TestFixture]
public class Test_008_000_001
{
    private IServiceProvider serviceProvider;

    private static readonly Assembly CurrentAssembly = typeof(StartUp).Assembly;

    [SetUp]
    public void Setup()
    {
        /*Mapper.Reset();
          Mapper.Initialize(cfg => cfg.AddProfile(GetType("ProductShopProfile")));*/

        var config = new MapperConfiguration(cfg =>
        {
            cfg.AddProfile<ProductShopProfile>();
        });

        this.serviceProvider = ConfigureServices<ProductShopContext>("ProductShop");
    }

    [Test]
    public void ExportUsersProductsTests()
    {
        var context = this.serviceProvider.GetService<ProductShopContext>();

        SeedDatabase(context);

        var expectedOutputValue = "{\"usersCount\":54,\"users\":[{\"lastName\":\"Stewart\",\"age\":39,\"soldProducts\":{\"count\":9,\"products\":[{\"name\":\"Finasteride\",\"price\":1374.01},{\"name\":\"Glyburide\",\"price\":95.1},{\"name\":\"GOONG SECRET CALMING BATH\",\"price\":742.47},{\"name\":\"EMEND\",\"price\":1365.51},{\"name\":\"Allergena\",\"price\":109.32},{\"name\":\"IOPE RETIGEN MOISTURE TWIN CAKE NO.21\",\"price\":1257.71},{\"name\":\"Fair Foundation SPF 15\",\"price\":1394.24},{\"name\":\"ESIKA\",\"price\":879.37},{\"name\":\"allergy eye\",\"price\":426.91}]}},{\"lastName\":\"Peterson\",\"age\":72,\"soldProducts\":{\"count\":7,\"products\":[{\"name\":\"Topical 60 Sec Sodium Fluoride\",\"price\":1228.84},{\"name\":\"Growing Pains\",\"price\":1077.37},{\"name\":\"Glycopyrrolate\",\"price\":1471.43},{\"name\":\"Baza Antifungal\",\"price\":1162.34},{\"name\":\"Foaming Hand Sanitizer\",\"price\":624.72},{\"name\":\"Amitriptyline Hydrochloride\",\"price\":1453.96},{\"name\":\"TYLENOL COLD MULTI-SYMPTOM DAYTIME\",\"price\":1010.81}]}},{\"firstName\":\"Gary\",\"lastName\":\"Stevens\",\"soldProducts\":{\"count\":6,\"products\":[{\"name\":\"smart sense nighttime cold and flu relief\",\"price\":1101.77},{\"name\":\"cough and sore throat\",\"price\":1482.68},{\"name\":\"PRIMAXIN\",\"price\":686.66},{\"name\":\"Pollens - Trees, Birch Mix\",\"price\":1153.54},{\"name\":\"PREMIER VALUE ALLERGY\",\"price\":1127.61},{\"name\":\"Prostate\",\"price\":716.05}]}},{\"lastName\":\"Harrison\",\"age\":18,\"soldProducts\":{\"count\":6,\"products\":[{\"name\":\"Agaricus Equisetum Special Order\",\"price\":585.93},{\"name\":\"Flumazenil\",\"price\":1151.37},{\"name\":\"Ringers\",\"price\":1054.37},{\"name\":\"pain relief\",\"price\":938.23},{\"name\":\"Ketorolac Tromethamine\",\"price\":608.18},{\"name\":\"Yellow Jacket hymenoptera venom Venomil Diagnostic\",\"price\":23.58}]}},{\"firstName\":\"Emily\",\"lastName\":\"Parker\",\"age\":41,\"soldProducts\":{\"count\":6,\"products\":[{\"name\":\"kirkland signature minoxidil\",\"price\":49.17},{\"name\":\"NEO-POLY-BAC HYDRO\",\"price\":967.32},{\"name\":\"Labetalol hydrochloride\",\"price\":436.38},{\"name\":\"Nevirapine\",\"price\":1374.72},{\"name\":\"Homeopathic Rheumatism\",\"price\":967.08},{\"name\":\"ziprasidone hydrochloride\",\"price\":628.66}]}},{\"lastName\":\"Fox\",\"age\":68,\"soldProducts\":{\"count\":5,\"products\":[{\"name\":\"Wintergreen Isopropyl Alcohol\",\"price\":1397.57},{\"name\":\"Aspen\",\"price\":1046.46},{\"name\":\"Ondansetron\",\"price\":1249.76},{\"name\":\"VITALUMIERE AQUA\",\"price\":1293.09},{\"name\":\"Etodolac\",\"price\":1443.13}]}},{\"firstName\":\"Benjamin\",\"lastName\":\"Henry\",\"age\":63,\"soldProducts\":{\"count\":5,\"products\":[{\"name\":\"SNORING HP\",\"price\":53.59},{\"name\":\"Phenylephrine HCl\",\"price\":459.89},{\"name\":\"Warfarin Sodium\",\"price\":770.05},{\"name\":\"AVANDAMET\",\"price\":632.08},{\"name\":\"DIPYRIDAMOLE\",\"price\":1150.67}]}},{\"firstName\":\"Nicole\",\"lastName\":\"Martinez\",\"age\":28,\"soldProducts\":{\"count\":5,\"products\":[{\"name\":\"Care One Hemorrhoidal\",\"price\":932.18},{\"name\":\"Isosorbide Mononitrate\",\"price\":789.91},{\"name\":\"PANTOPRAZOLE SODIUM\",\"price\":293.89},{\"name\":\"SUMATRIPTAN SUCCINATE\",\"price\":1265.94},{\"name\":\"Acid Reducer\",\"price\":1443.51}]}},{\"firstName\":\"Joshua\",\"lastName\":\"Murray\",\"age\":41,\"soldProducts\":{\"count\":5,\"products\":[{\"name\":\"Metformin Hydrochloride\",\"price\":953.99},{\"name\":\"ENBREL\",\"price\":673.97},{\"name\":\"ropinirole hydrochloride\",\"price\":103.58},{\"name\":\"Buprenorphine hydrochloride\",\"price\":391.05},{\"name\":\"Laser Block 100\",\"price\":1135.43}]}},{\"firstName\":\"Paula\",\"lastName\":\"Hill\",\"age\":74,\"soldProducts\":{\"count\":5,\"products\":[{\"name\":\"Lamotrigine Extended Release\",\"price\":245.63},{\"name\":\"CLARINS Ever Matte SPF 15 - 105 Nude\",\"price\":696.06},{\"name\":\"Alcohol Free Antiseptic\",\"price\":1486.07},{\"name\":\"Warfarin Sodium\",\"price\":1379.79},{\"name\":\"Topiramate\",\"price\":578.77}]}},{\"firstName\":\"Christine\",\"lastName\":\"Gomez\",\"age\":28,\"soldProducts\":{\"count\":5,\"products\":[{\"name\":\"ORCHID SECRET PACT\",\"price\":59.53},{\"name\":\"Fexofenadine HCl and Pseudoephedrine HCI\",\"price\":73.07},{\"name\":\"Effervescent Cold Relief\",\"price\":1436.07},{\"name\":\"Gemcitabine\",\"price\":594.79},{\"name\":\"Gehwol med Lipidro\",\"price\":421.24}]}},{\"firstName\":\"Eugene\",\"lastName\":\"Stewart\",\"age\":65,\"soldProducts\":{\"count\":4,\"products\":[{\"name\":\"Topex\",\"price\":1258.49},{\"name\":\"Meloxicam\",\"price\":809.18},{\"name\":\"Aspirin\",\"price\":925.45},{\"name\":\"Retin-A MICRO\",\"price\":995.98}]}},{\"firstName\":\"Anna\",\"lastName\":\"Clark\",\"age\":41,\"soldProducts\":{\"count\":4,\"products\":[{\"name\":\"CHAMOMILLA\",\"price\":37.97},{\"name\":\"No7 Protect and Perfect Foundation Sunscreen Broad Spectrum SPF 15 Cool Ivory\",\"price\":616.19},{\"name\":\"Benazepril Hydrochloride and Hydrochlorothiazide\",\"price\":1187.27},{\"name\":\"Ibuprofen\",\"price\":1305.96}]}},{\"firstName\":\"Carl\",\"lastName\":\"Daniels\",\"age\":59,\"soldProducts\":{\"count\":4,\"products\":[{\"name\":\"SEPHORA Acne-Fighting Mattifying Moisturizer\",\"price\":1019.28},{\"name\":\"Etomidate\",\"price\":393.94},{\"name\":\"Metaxalone\",\"price\":79.94},{\"name\":\"Imipramine Hydrochloride\",\"price\":648.69}]}},{\"firstName\":\"Carl\",\"lastName\":\"Lawson\",\"age\":19,\"soldProducts\":{\"count\":4,\"products\":[{\"name\":\"Pleo Lat\",\"price\":720.08},{\"name\":\"LBEL Couleur Luxe Rouge Amplifier XP amplifying SPF 15\",\"price\":1069.43},{\"name\":\"DIVALPROEX SODIUM\",\"price\":1287.03},{\"name\":\"Naproxen\",\"price\":807.22}]}},{\"firstName\":\"Brenda\",\"lastName\":\"Howell\",\"age\":75,\"soldProducts\":{\"count\":4,\"products\":[{\"name\":\"TERSI\",\"price\":554.91},{\"name\":\"Archangelica Eucalyptus\",\"price\":1334.91},{\"name\":\"Parsley\",\"price\":519.06},{\"name\":\"XtraCare Foam Antibacterial Hand Wash\",\"price\":1251.97}]}},{\"lastName\":\"Moreno\",\"age\":37,\"soldProducts\":{\"count\":4,\"products\":[{\"name\":\"Childrens Allegra Allergy\",\"price\":650.97},{\"name\":\"Amlodipine Besylate\",\"price\":122.57},{\"name\":\"Gilotrif\",\"price\":1454.77},{\"name\":\"BareMinerals Golden Tan matte\",\"price\":110.93}]}},{\"firstName\":\"Patricia\",\"lastName\":\"Cooper\",\"age\":72,\"soldProducts\":{\"count\":4,\"products\":[{\"name\":\"Peter Island Continous sunscreen kids\",\"price\":471.3},{\"name\":\"CARBIDOPA AND LEVODOPA\",\"price\":441.64},{\"name\":\"Fluoxetine\",\"price\":385.37},{\"name\":\"Extra Strength Pain Reliever PM\",\"price\":542.72}]}},{\"firstName\":\"Jacqueline\",\"lastName\":\"Perez\",\"age\":25,\"soldProducts\":{\"count\":4,\"products\":[{\"name\":\"ROPINIROLE HYDROCHLORIDE\",\"price\":266.44},{\"name\":\"Almond\",\"price\":367.32},{\"name\":\"Allopurinol\",\"price\":518.5},{\"name\":\"Carbon Dioxide Oxygen Mixture\",\"price\":95.49}]}},{\"firstName\":\"Jeremy\",\"lastName\":\"Woods\",\"age\":20,\"soldProducts\":{\"count\":4,\"products\":[{\"name\":\"Smooth texture Orange flavor\",\"price\":976.65},{\"name\":\"Etoposide\",\"price\":1483.96},{\"name\":\"Allopurinol\",\"price\":336.81},{\"name\":\"ISOPROPYL ALCOHOL\",\"price\":339.48}]}},{\"firstName\":\"Fred\",\"lastName\":\"Barnes\",\"soldProducts\":{\"count\":4,\"products\":[{\"name\":\"Buprenorphine hydrochloride and naloxone hydrochloride dihydrate\",\"price\":293.33},{\"name\":\"Protonix\",\"price\":466.7},{\"name\":\"Ranitidine\",\"price\":926.64},{\"name\":\"Air\",\"price\":331.53}]}},{\"firstName\":\"Chris\",\"lastName\":\"Mitchell\",\"age\":59,\"soldProducts\":{\"count\":4,\"products\":[{\"name\":\"Glipizide and Metformin Hydrochloride\",\"price\":953.6},{\"name\":\"Megestrol Acetate\",\"price\":976.15},{\"name\":\"Aquafresh\",\"price\":849.93},{\"name\":\"Warfarin Sodium\",\"price\":138.83}]}},{\"firstName\":\"Thomas\",\"lastName\":\"Snyder\",\"age\":40,\"soldProducts\":{\"count\":4,\"products\":[{\"name\":\"Enalapril Maleate\",\"price\":72.71},{\"name\":\"Leflunomide\",\"price\":312.85},{\"name\":\"MEDI-FIRST Non-Aspirin\",\"price\":1301.28},{\"name\":\"Echinacea Quartz Gum Support\",\"price\":570.08}]}},{\"firstName\":\"Marie\",\"lastName\":\"Williamson\",\"soldProducts\":{\"count\":4,\"products\":[{\"name\":\"XANTHIUM STRUMARIUM VAR CANADENSE POLLEN\",\"price\":1091.38},{\"name\":\"H-Rosacea Formula\",\"price\":99.74},{\"name\":\"Trihexyphenidyl Hydrochloride\",\"price\":64.88},{\"name\":\"Enchanted Moments Mistletoe Kisses Hand Sanitizer\",\"price\":384.99}]}},{\"lastName\":\"Schmidt\",\"age\":70,\"soldProducts\":{\"count\":3,\"products\":[{\"name\":\"Oxygen\",\"price\":1242.92},{\"name\":\"Head and Shoulders Conditioner\",\"price\":1099.59},{\"name\":\"up and up temporary minor arthritis pain relief\",\"price\":1085.78}]}},{\"firstName\":\"Brandon\",\"lastName\":\"Fuller\",\"age\":30,\"soldProducts\":{\"count\":3,\"products\":[{\"name\":\"Labetalol Hydrochloride\",\"price\":1345.11},{\"name\":\"Americaine\",\"price\":1165.75},{\"name\":\"CALMING DIAPER RASH\",\"price\":700.92}]}},{\"firstName\":\"Rachel\",\"lastName\":\"Johnson\",\"age\":24,\"soldProducts\":{\"count\":3,\"products\":[{\"name\":\"Pollens - Weeds and Garden Plants, Nettle Urtica dioica\",\"price\":782.77},{\"name\":\"Perrigo Benzoyl Peroxide\",\"price\":873.24},{\"name\":\"Amitiza\",\"price\":666.58}]}},{\"lastName\":\"Baker\",\"soldProducts\":{\"count\":3,\"products\":[{\"name\":\"Prednisone\",\"price\":550.72},{\"name\":\"equaline\",\"price\":520.45},{\"name\":\"Acetic Acid\",\"price\":1060.43}]}},{\"lastName\":\"Thompson\",\"age\":46,\"soldProducts\":{\"count\":3,\"products\":[{\"name\":\"Clarins Paris Skin Illusion - 114 cappuccino\",\"price\":811.42},{\"name\":\"AMARANTHUS PALMERI POLLEN\",\"price\":623.16},{\"name\":\"Irbesartan and Hydrochlorothiazide\",\"price\":308.3}]}},{\"firstName\":\"Ann\",\"lastName\":\"Stevens\",\"soldProducts\":{\"count\":3,\"products\":[{\"name\":\"MEDICATED DANDRUFF\",\"price\":1351.02},{\"name\":\"Shopko Lip Treatment\",\"price\":861.42},{\"name\":\"Nighttime Sleep Aid\",\"price\":1217.11}]}},{\"firstName\":\"Christina\",\"lastName\":\"Patterson\",\"age\":63,\"soldProducts\":{\"count\":3,\"products\":[{\"name\":\"Myristica Argentum Sinus Relief\",\"price\":904.52},{\"name\":\"MOIST MOISTURE SKIN TONER\",\"price\":152.43},{\"name\":\"smart sense nicotine\",\"price\":1444.12}]}},{\"firstName\":\"Jonathan\",\"lastName\":\"Rodriguez\",\"soldProducts\":{\"count\":3,\"products\":[{\"name\":\"LANEIGE MYSTIC VEIL FOUNDATION\",\"price\":20.86},{\"name\":\"Pollens - Weeds and Garden Plants, Scotch Broom Cytisus scoparius\",\"price\":135.82},{\"name\":\"Butalbital, Aspirin and Caffeine\",\"price\":1010.98}]}},{\"firstName\":\"Anna\",\"lastName\":\"Parker\",\"age\":56,\"soldProducts\":{\"count\":3,\"products\":[{\"name\":\"ESIKA 3-IN-1 PRO MAKE UP FOUNDATION SPF 20 BASE DE MAQUILLAJE PARA ROSTRO 3-EN-1 PRO FPS 20\",\"price\":1097.6},{\"name\":\"Leg Cramp Relief\",\"price\":1345.69},{\"name\":\"leader pain reliever\",\"price\":1179.79}]}},{\"firstName\":\"Betty\",\"lastName\":\"Ward\",\"age\":70,\"soldProducts\":{\"count\":3,\"products\":[{\"name\":\"Albuterol\",\"price\":108.95},{\"name\":\"Lorazepam\",\"price\":1134.96},{\"name\":\"PLANTAGO LANCEOLATA POLLEN\",\"price\":561.68}]}},{\"firstName\":\"Patricia\",\"lastName\":\"Fuller\",\"age\":36,\"soldProducts\":{\"count\":3,\"products\":[{\"name\":\"Levothyroxine Sodium\",\"price\":885.86},{\"name\":\"LV-FX\",\"price\":820.87},{\"name\":\"Budpak Hemorrhoid Anesthetic\",\"price\":1499.29}]}},{\"firstName\":\"Fred\",\"lastName\":\"Allen\",\"age\":57,\"soldProducts\":{\"count\":2,\"products\":[{\"name\":\"IOPE SUPER VITAL\",\"price\":824.68},{\"name\":\"Triamterene and Hydrochlorothiazide\",\"price\":1416.59}]}},{\"firstName\":\"Clarence\",\"lastName\":\"Fowler\",\"age\":50,\"soldProducts\":{\"count\":2,\"products\":[{\"name\":\"Eszopiclone\",\"price\":405.03},{\"name\":\"Allopurinol\",\"price\":48.8}]}},{\"firstName\":\"Betty\",\"lastName\":\"Lawson\",\"age\":38,\"soldProducts\":{\"count\":2,\"products\":[{\"name\":\"Glipizide\",\"price\":621.78},{\"name\":\"Cold and Cough\",\"price\":218.14}]}},{\"lastName\":\"Bennett\",\"soldProducts\":{\"count\":2,\"products\":[{\"name\":\"Clearskin\",\"price\":968.59},{\"name\":\"Pleo Ginkgo\",\"price\":613.65}]}},{\"firstName\":\"Sandra\",\"lastName\":\"Riley\",\"age\":74,\"soldProducts\":{\"count\":2,\"products\":[{\"name\":\"U-max Multi BB\",\"price\":137.16},{\"name\":\"Stila Hydrating Primer Oil-Free SPF 30\",\"price\":179.28}]}},{\"firstName\":\"Nicole\",\"lastName\":\"Harris\",\"age\":43,\"soldProducts\":{\"count\":2,\"products\":[{\"name\":\"Azithromycin\",\"price\":813.87},{\"name\":\"Pioglitazone\",\"price\":306.56}]}},{\"firstName\":\"Amanda\",\"lastName\":\"Frazier\",\"soldProducts\":{\"count\":2,\"products\":[{\"name\":\"EPZICOM\",\"price\":895.65},{\"name\":\"Prednisone\",\"price\":1285.99}]}},{\"firstName\":\"Diana\",\"lastName\":\"Harvey\",\"age\":46,\"soldProducts\":{\"count\":2,\"products\":[{\"name\":\"Fosphenytoin Sodium\",\"price\":1334.06},{\"name\":\"Cefadroxil\",\"price\":1302.2}]}},{\"firstName\":\"Bonnie\",\"lastName\":\"Fox\",\"age\":18,\"soldProducts\":{\"count\":2,\"products\":[{\"name\":\"Strattera\",\"price\":658.54},{\"name\":\"Aspergillus repens\",\"price\":1231.42}]}},{\"lastName\":\"Cunningham\",\"soldProducts\":{\"count\":2,\"products\":[{\"name\":\"ENALAPRIL MALEATE\",\"price\":210.42},{\"name\":\"Acnezzol Base\",\"price\":710.6}]}},{\"firstName\":\"Arthur\",\"lastName\":\"Reynolds\",\"age\":32,\"soldProducts\":{\"count\":2,\"products\":[{\"name\":\"Alternaria alternata\",\"price\":61.24},{\"name\":\"Treatment Set TS336667\",\"price\":1466.47}]}},{\"firstName\":\"Doris\",\"lastName\":\"Cook\",\"age\":61,\"soldProducts\":{\"count\":2,\"products\":[{\"name\":\"Dawn Ultra Antibacterial Hand\",\"price\":969.86},{\"name\":\"ANXIETY/STRESS RELIEF\",\"price\":324.66}]}},{\"firstName\":\"Gloria\",\"lastName\":\"Alexander\",\"age\":61,\"soldProducts\":{\"count\":1,\"products\":[{\"name\":\"Metoprolol Tartrate\",\"price\":1405.74}]}},{\"firstName\":\"Sarah\",\"lastName\":\"Day\",\"age\":33,\"soldProducts\":{\"count\":1,\"products\":[{\"name\":\"PredniSONE\",\"price\":286.43}]}},{\"firstName\":\"Jennifer\",\"lastName\":\"Riley\",\"soldProducts\":{\"count\":1,\"products\":[{\"name\":\"Diastat\",\"price\":614.14}]}},{\"firstName\":\"Jean\",\"lastName\":\"Henry\",\"soldProducts\":{\"count\":1,\"products\":[{\"name\":\"GEMCITABINE\",\"price\":1468.11}]}},{\"firstName\":\"Billy\",\"lastName\":\"Parker\",\"age\":68,\"soldProducts\":{\"count\":1,\"products\":[{\"name\":\"CD CAPTURE TOTALE Triple Correcting Serum Foundation Wrinkles-Dark Spots-Radiance with sunscreen Broad Spectrum SPF 25 010\",\"price\":77.23}]}},{\"firstName\":\"Kathy\",\"lastName\":\"Gilbert\",\"age\":51,\"soldProducts\":{\"count\":1,\"products\":[{\"name\":\"AIR\",\"price\":581.69}]}},{\"firstName\":\"Wanda\",\"lastName\":\"Harris\",\"age\":26,\"soldProducts\":{\"count\":1,\"products\":[{\"name\":\"DAYWEAR PLUS MULTI PROTECTION TINTED MOISTURIZER\",\"price\":555.12}]}}]}";

        var expectedOutput = JToken.Parse(expectedOutputValue);
        var actualOutputValue = StartUp.GetUsersWithProducts(context);
        var actualOutput = JToken.Parse(actualOutputValue);

        var expected = expectedOutput.ToString(Newtonsoft.Json.Formatting.None);
        var actual = actualOutput.ToString(Newtonsoft.Json.Formatting.None);

        Assert.That(actual, Is.EqualTo(expected).NoClip,
            $"{nameof(StartUp.GetUsersWithProducts)} output is incorrect!");
    }

    private static void SeedDatabase(ProductShopContext context)
    {
        var productsJson =
            @"[{""Name"":""Care One Hemorrhoidal"",""Price"":932.18,""SellerId"":25,""BuyerId"":24},{""Name"":""SNORING HP"",""Price"":53.59,""SellerId"":24,""BuyerId"":30},{""Name"":""ROPINIROLE HYDROCHLORIDE"",""Price"":266.44,""SellerId"":33,""BuyerId"":16},{""Name"":""kirkland signature minoxidil"",""Price"":49.17,""SellerId"":38,""BuyerId"":39},{""Name"":""Agaricus Equisetum Special Order"",""Price"":585.93,""SellerId"":22,""BuyerId"":27},{""Name"":""Lamotrigine Extended Release"",""Price"":245.63,""SellerId"":39,""BuyerId"":38},{""Name"":""CLARINS Ever Matte SPF 15 - 105 Nude"",""Price"":696.06,""SellerId"":39,""BuyerId"":56},{""Name"":""Childrens Allegra Allergy"",""Price"":650.97,""SellerId"":15,""BuyerId"":36},{""Name"":""PredniSONE"",""Price"":286.43,""SellerId"":31,""BuyerId"":32},{""Name"":""Spironolactone"",""Price"":933.69,""SellerId"":44,""BuyerId"":null},{""Name"":""U-max Multi BB"",""Price"":137.16,""SellerId"":20,""BuyerId"":35},{""Name"":""Phenylephrine HCl"",""Price"":459.89,""SellerId"":24,""BuyerId"":53},{""Name"":""Finasteride"",""Price"":1374.01,""SellerId"":16,""BuyerId"":55},{""Name"":""Clarins Paris Skin Illusion - 114 cappuccino"",""Price"":811.42,""SellerId"":28,""BuyerId"":12},{""Name"":""Enalapril Maleate"",""Price"":72.71,""SellerId"":53,""BuyerId"":24},{""Name"":""MEDICATED DANDRUFF"",""Price"":1351.02,""SellerId"":29,""BuyerId"":42},{""Name"":""Pleo Lat"",""Price"":720.08,""SellerId"":7,""BuyerId"":50},{""Name"":""Myristica Argentum Sinus Relief"",""Price"":904.52,""SellerId"":30,""BuyerId"":47},{""Name"":""Glyburide"",""Price"":95.1,""SellerId"":16,""BuyerId"":18},{""Name"":""Burn Jel"",""Price"":209.57,""SellerId"":34,""BuyerId"":null},{""Name"":""CHAMOMILLA"",""Price"":37.97,""SellerId"":5,""BuyerId"":48},{""Name"":""NEO-POLY-BAC HYDRO"",""Price"":967.32,""SellerId"":38,""BuyerId"":48},{""Name"":""Prednisone"",""Price"":550.72,""SellerId"":26,""BuyerId"":44},{""Name"":""Isosorbide Mononitrate"",""Price"":789.91,""SellerId"":25,""BuyerId"":10},{""Name"":""Glipizide and Metformin Hydrochloride"",""Price"":953.6,""SellerId"":50,""BuyerId"":41},{""Name"":""TERSI"",""Price"":554.91,""SellerId"":12,""BuyerId"":1},{""Name"":""SEPHORA Acne-Fighting Mattifying Moisturizer"",""Price"":1019.28,""SellerId"":6,""BuyerId"":31},{""Name"":""Smooth texture Orange flavor"",""Price"":976.65,""SellerId"":41,""BuyerId"":12},{""Name"":""DAYWEAR PLUS MULTI PROTECTION TINTED MOISTURIZER"",""Price"":555.12,""SellerId"":55,""BuyerId"":19},{""Name"":""Zonisamide"",""Price"":1305.41,""SellerId"":29,""BuyerId"":null},{""Name"":""Peter Island Continous sunscreen kids"",""Price"":471.3,""SellerId"":27,""BuyerId"":39},{""Name"":""GOONG SECRET CALMING BATH"",""Price"":742.47,""SellerId"":16,""BuyerId"":30},{""Name"":""Clearskin"",""Price"":968.59,""SellerId"":11,""BuyerId"":9},{""Name"":""No7 Protect and Perfect Foundation Sunscreen Broad Spectrum SPF 15 Cool Ivory"",""Price"":616.19,""SellerId"":5,""BuyerId"":55},{""Name"":""Alcohol Free Antiseptic"",""Price"":1486.07,""SellerId"":39,""BuyerId"":26},{""Name"":""smart sense nighttime cold and flu relief"",""Price"":1101.77,""SellerId"":9,""BuyerId"":13},{""Name"":""Warfarin Sodium"",""Price"":1379.79,""SellerId"":39,""BuyerId"":17},{""Name"":""Oxygen"",""Price"":1242.92,""SellerId"":13,""BuyerId"":14},{""Name"":""Amlodipine Besylate"",""Price"":122.57,""SellerId"":15,""BuyerId"":4},{""Name"":""CVS Therapeutic Menthol Pain Reliever"",""Price"":1033.42,""SellerId"":4,""BuyerId"":null},{""Name"":""Warfarin Sodium"",""Price"":770.05,""SellerId"":24,""BuyerId"":29},{""Name"":""Gilotrif"",""Price"":1454.77,""SellerId"":15,""BuyerId"":47},{""Name"":""Shopko Lip Treatment"",""Price"":861.42,""SellerId"":29,""BuyerId"":40},{""Name"":""Albuterol"",""Price"":108.95,""SellerId"":47,""BuyerId"":45},{""Name"":""Eszopiclone"",""Price"":405.03,""SellerId"":3,""BuyerId"":56},{""Name"":""EMEND"",""Price"":1365.51,""SellerId"":16,""BuyerId"":36},{""Name"":""Etomidate"",""Price"":393.94,""SellerId"":6,""BuyerId"":40},{""Name"":""Megestrol Acetate"",""Price"":976.15,""SellerId"":50,""BuyerId"":28},{""Name"":""Head and Shoulders Conditioner"",""Price"":1099.59,""SellerId"":13,""BuyerId"":36},{""Name"":""ERYTHROMYCIN Base Filmtab"",""Price"":117.84,""SellerId"":39,""BuyerId"":null},{""Name"":""Flumazenil"",""Price"":1151.37,""SellerId"":22,""BuyerId"":27},{""Name"":""LANEIGE MYSTIC VEIL FOUNDATION"",""Price"":20.86,""SellerId"":43,""BuyerId"":28},{""Name"":""EPZICOM"",""Price"":895.65,""SellerId"":34,""BuyerId"":35},{""Name"":""Almond"",""Price"":367.32,""SellerId"":33,""BuyerId"":9},{""Name"":""Etoposide"",""Price"":1483.96,""SellerId"":41,""BuyerId"":27},{""Name"":""ESIKA 3-IN-1 PRO MAKE UP FOUNDATION SPF 20 BASE DE MAQUILLAJE PARA ROSTRO 3-EN-1 PRO FPS 20"",""Price"":1097.6,""SellerId"":46,""BuyerId"":10},{""Name"":""Levothyroxine Sodium"",""Price"":885.86,""SellerId"":48,""BuyerId"":15},{""Name"":""Dawn Ultra Antibacterial Hand"",""Price"":969.86,""SellerId"":56,""BuyerId"":51},{""Name"":""cough and sore throat"",""Price"":1482.68,""SellerId"":9,""BuyerId"":11},{""Name"":""Moore Medical Sinus Pain and Pressure Relief"",""Price"":855.39,""SellerId"":43,""BuyerId"":null},{""Name"":""Glipizide"",""Price"":621.78,""SellerId"":4,""BuyerId"":1},{""Name"":""Fosphenytoin Sodium"",""Price"":1334.06,""SellerId"":37,""BuyerId"":25},{""Name"":""ENALAPRIL MALEATE"",""Price"":210.42,""SellerId"":51,""BuyerId"":14},{""Name"":""LV-FX"",""Price"":820.87,""SellerId"":48,""BuyerId"":40},{""Name"":""Wintergreen Isopropyl Alcohol"",""Price"":1397.57,""SellerId"":8,""BuyerId"":26},{""Name"":""ORCHID SECRET PACT"",""Price"":59.53,""SellerId"":42,""BuyerId"":19},{""Name"":""Metaxalone"",""Price"":79.94,""SellerId"":6,""BuyerId"":19},{""Name"":""Allergena"",""Price"":109.32,""SellerId"":16,""BuyerId"":38},{""Name"":""XANTHIUM STRUMARIUM VAR CANADENSE POLLEN"",""Price"":1091.38,""SellerId"":54,""BuyerId"":35},{""Name"":""Ampicillin"",""Price"":674.63,""SellerId"":49,""BuyerId"":null},{""Name"":""Buprenorphine hydrochloride and naloxone hydrochloride dihydrate"",""Price"":293.33,""SellerId"":45,""BuyerId"":18},{""Name"":""Acnezzol Base"",""Price"":710.6,""SellerId"":51,""BuyerId"":46},{""Name"":""AMARANTHUS PALMERI POLLEN"",""Price"":623.16,""SellerId"":28,""BuyerId"":32},{""Name"":""PANTOPRAZOLE SODIUM"",""Price"":293.89,""SellerId"":25,""BuyerId"":40},{""Name"":""Cold and Cough"",""Price"":218.14,""SellerId"":4,""BuyerId"":43},{""Name"":""Metformin Hydrochloride"",""Price"":953.99,""SellerId"":35,""BuyerId"":12},{""Name"":""LBEL Couleur Luxe Rouge Amplifier XP amplifying SPF 15"",""Price"":1069.43,""SellerId"":7,""BuyerId"":6},{""Name"":""Diastat"",""Price"":614.14,""SellerId"":32,""BuyerId"":3},{""Name"":""Topical 60 Sec Sodium Fluoride"",""Price"":1228.84,""SellerId"":17,""BuyerId"":4},{""Name"":""TRAMADOL HYDROCHLORIDE"",""Price"":516.48,""SellerId"":28,""BuyerId"":null},{""Name"":""Fexofenadine HCl and Pseudoephedrine HCI"",""Price"":73.07,""SellerId"":42,""BuyerId"":1},{""Name"":""equaline"",""Price"":520.45,""SellerId"":26,""BuyerId"":11},{""Name"":""Leg Cramp Relief"",""Price"":1345.69,""SellerId"":46,""BuyerId"":15},{""Name"":""CD CAPTURE TOTALE Triple Correcting Serum Foundation Wrinkles-Dark Spots-Radiance with sunscreen Broad Spectrum SPF 25 010"",""Price"":77.23,""SellerId"":40,""BuyerId"":4},{""Name"":""PRIMAXIN"",""Price"":686.66,""SellerId"":9,""BuyerId"":22},{""Name"":""H-Rosacea Formula"",""Price"":99.74,""SellerId"":54,""BuyerId"":49},{""Name"":""Benazepril Hydrochloride and Hydrochlorothiazide"",""Price"":1187.27,""SellerId"":5,""BuyerId"":22},{""Name"":""Leflunomide"",""Price"":312.85,""SellerId"":53,""BuyerId"":4},{""Name"":""BareMinerals Golden Tan matte"",""Price"":110.93,""SellerId"":15,""BuyerId"":46},{""Name"":""CEDAX"",""Price"":342.86,""SellerId"":27,""BuyerId"":null},{""Name"":""Topex"",""Price"":1258.49,""SellerId"":1,""BuyerId"":10},{""Name"":""DIVALPROEX SODIUM"",""Price"":1287.03,""SellerId"":7,""BuyerId"":40},{""Name"":""Acetic Acid"",""Price"":1060.43,""SellerId"":26,""BuyerId"":35},{""Name"":""MEDI-FIRST Non-Aspirin"",""Price"":1301.28,""SellerId"":53,""BuyerId"":52},{""Name"":""Lorazepam"",""Price"":1134.96,""SellerId"":47,""BuyerId"":10},{""Name"":""Alternaria alternata"",""Price"":61.24,""SellerId"":52,""BuyerId"":35},{""Name"":""Budpak Hemorrhoid Anesthetic"",""Price"":1499.29,""SellerId"":48,""BuyerId"":56},{""Name"":""Ringers"",""Price"":1054.37,""SellerId"":22,""BuyerId"":30},{""Name"":""Allopurinol"",""Price"":518.5,""SellerId"":33,""BuyerId"":25},{""Name"":""REYATAZ"",""Price"":41.97,""SellerId"":42,""BuyerId"":null},{""Name"":""Carbon Dioxide Oxygen Mixture"",""Price"":95.49,""SellerId"":33,""BuyerId"":6},{""Name"":""IOPE RETIGEN MOISTURE TWIN CAKE NO.21"",""Price"":1257.71,""SellerId"":16,""BuyerId"":23},{""Name"":""MOIST MOISTURE SKIN TONER"",""Price"":152.43,""SellerId"":30,""BuyerId"":28},{""Name"":""Strattera"",""Price"":658.54,""SellerId"":49,""BuyerId"":27},{""Name"":""Aquafresh"",""Price"":849.93,""SellerId"":50,""BuyerId"":13},{""Name"":""Nighttime Sleep Aid"",""Price"":1217.11,""SellerId"":29,""BuyerId"":12},{""Name"":""Pollens - Weeds and Garden Plants, Nettle Urtica dioica"",""Price"":782.77,""SellerId"":19,""BuyerId"":13},{""Name"":""Perrigo Benzoyl Peroxide"",""Price"":873.24,""SellerId"":19,""BuyerId"":17},{""Name"":""ENBREL"",""Price"":673.97,""SellerId"":35,""BuyerId"":26},{""Name"":""Propranolol Hydrochloride"",""Price"":546.95,""SellerId"":27,""BuyerId"":null},{""Name"":""Allopurinol"",""Price"":48.8,""SellerId"":3,""BuyerId"":30},{""Name"":""Trihexyphenidyl Hydrochloride"",""Price"":64.88,""SellerId"":54,""BuyerId"":40},{""Name"":""Archangelica Eucalyptus"",""Price"":1334.91,""SellerId"":12,""BuyerId"":4},{""Name"":""Effervescent Cold Relief"",""Price"":1436.07,""SellerId"":42,""BuyerId"":46},{""Name"":""Allopurinol"",""Price"":336.81,""SellerId"":41,""BuyerId"":9},{""Name"":""Parsley"",""Price"":519.06,""SellerId"":12,""BuyerId"":32},{""Name"":""Protonix"",""Price"":466.7,""SellerId"":45,""BuyerId"":13},{""Name"":""Pollens - Trees, Birch Mix"",""Price"":1153.54,""SellerId"":9,""BuyerId"":36},{""Name"":""ropinirole hydrochloride"",""Price"":103.58,""SellerId"":35,""BuyerId"":25},{""Name"":""olio activ mouthwash"",""Price"":206.06,""SellerId"":51,""BuyerId"":null},{""Name"":""CARBIDOPA AND LEVODOPA"",""Price"":441.64,""SellerId"":27,""BuyerId"":11},{""Name"":""Pollens - Weeds and Garden Plants, Scotch Broom Cytisus scoparius"",""Price"":135.82,""SellerId"":43,""BuyerId"":20},{""Name"":""Azithromycin"",""Price"":813.87,""SellerId"":23,""BuyerId"":25},{""Name"":""Meloxicam"",""Price"":809.18,""SellerId"":1,""BuyerId"":21},{""Name"":""pain relief"",""Price"":938.23,""SellerId"":22,""BuyerId"":46},{""Name"":""GEMCITABINE"",""Price"":1468.11,""SellerId"":36,""BuyerId"":48},{""Name"":""Topiramate"",""Price"":578.77,""SellerId"":39,""BuyerId"":31},{""Name"":""Cefadroxil"",""Price"":1302.2,""SellerId"":37,""BuyerId"":44},{""Name"":""Warfarin Sodium"",""Price"":138.83,""SellerId"":50,""BuyerId"":18},{""Name"":""PAMO Kill Natural"",""Price"":1181.06,""SellerId"":52,""BuyerId"":null},{""Name"":""Fluoxetine"",""Price"":385.37,""SellerId"":27,""BuyerId"":44},{""Name"":""Gemcitabine"",""Price"":594.79,""SellerId"":42,""BuyerId"":38},{""Name"":""Aspen"",""Price"":1046.46,""SellerId"":8,""BuyerId"":46},{""Name"":""AIR"",""Price"":581.69,""SellerId"":44,""BuyerId"":24},{""Name"":""AVANDAMET"",""Price"":632.08,""SellerId"":24,""BuyerId"":51},{""Name"":""Fair Foundation SPF 15"",""Price"":1394.24,""SellerId"":16,""BuyerId"":29},{""Name"":""Pleo Ginkgo"",""Price"":613.65,""SellerId"":11,""BuyerId"":33},{""Name"":""Irbesartan and Hydrochlorothiazide"",""Price"":308.3,""SellerId"":28,""BuyerId"":19},{""Name"":""IOPE SUPER VITAL"",""Price"":824.68,""SellerId"":2,""BuyerId"":28},{""Name"":""Ibuprofen"",""Price"":1088.04,""SellerId"":44,""BuyerId"":null},{""Name"":""PREMIER VALUE ALLERGY"",""Price"":1127.61,""SellerId"":9,""BuyerId"":35},{""Name"":""Labetalol Hydrochloride"",""Price"":1345.11,""SellerId"":14,""BuyerId"":5},{""Name"":""Prednisone"",""Price"":1285.99,""SellerId"":34,""BuyerId"":55},{""Name"":""Growing Pains"",""Price"":1077.37,""SellerId"":17,""BuyerId"":7},{""Name"":""Extra Strength Pain Reliever PM"",""Price"":542.72,""SellerId"":27,""BuyerId"":2},{""Name"":""Americaine"",""Price"":1165.75,""SellerId"":14,""BuyerId"":25},{""Name"":""Echinacea Quartz Gum Support"",""Price"":570.08,""SellerId"":53,""BuyerId"":24},{""Name"":""SUMATRIPTAN SUCCINATE"",""Price"":1265.94,""SellerId"":25,""BuyerId"":2},{""Name"":""Amitiza"",""Price"":666.58,""SellerId"":19,""BuyerId"":25},{""Name"":""Goats Milk"",""Price"":298.53,""SellerId"":1,""BuyerId"":null},{""Name"":""Glycopyrrolate"",""Price"":1471.43,""SellerId"":17,""BuyerId"":40},{""Name"":""Ondansetron"",""Price"":1249.76,""SellerId"":8,""BuyerId"":26},{""Name"":""Baza Antifungal"",""Price"":1162.34,""SellerId"":17,""BuyerId"":51},{""Name"":""Imipramine Hydrochloride"",""Price"":648.69,""SellerId"":6,""BuyerId"":46},{""Name"":""Aspirin"",""Price"":925.45,""SellerId"":1,""BuyerId"":16},{""Name"":""Retin-A MICRO"",""Price"":995.98,""SellerId"":1,""BuyerId"":9},{""Name"":""VITALUMIERE AQUA"",""Price"":1293.09,""SellerId"":8,""BuyerId"":6},{""Name"":""Stila Hydrating Primer Oil-Free SPF 30"",""Price"":179.28,""SellerId"":20,""BuyerId"":33},{""Name"":""Enchanted Moments Mistletoe Kisses Hand Sanitizer"",""Price"":384.99,""SellerId"":54,""BuyerId"":22},{""Name"":""PCA SKIN ACNE"",""Price"":1356.22,""SellerId"":46,""BuyerId"":null},{""Name"":""CALMING DIAPER RASH"",""Price"":700.92,""SellerId"":14,""BuyerId"":23},{""Name"":""Labetalol hydrochloride"",""Price"":436.38,""SellerId"":38,""BuyerId"":7},{""Name"":""Ketorolac Tromethamine"",""Price"":608.18,""SellerId"":22,""BuyerId"":32},{""Name"":""Foaming Hand Sanitizer"",""Price"":624.72,""SellerId"":17,""BuyerId"":28},{""Name"":""Aspergillus repens"",""Price"":1231.42,""SellerId"":49,""BuyerId"":12},{""Name"":""ISOPROPYL ALCOHOL"",""Price"":339.48,""SellerId"":41,""BuyerId"":18},{""Name"":""XtraCare Foam Antibacterial Hand Wash"",""Price"":1251.97,""SellerId"":12,""BuyerId"":33},{""Name"":""smart sense nicotine"",""Price"":1444.12,""SellerId"":30,""BuyerId"":11},{""Name"":""up and up temporary minor arthritis pain relief"",""Price"":1085.78,""SellerId"":13,""BuyerId"":29},{""Name"":""RESCRIPTOR"",""Price"":850.52,""SellerId"":29,""BuyerId"":null},{""Name"":""Buprenorphine hydrochloride"",""Price"":391.05,""SellerId"":35,""BuyerId"":13},{""Name"":""PLANTAGO LANCEOLATA POLLEN"",""Price"":561.68,""SellerId"":47,""BuyerId"":53},{""Name"":""Gehwol med Lipidro"",""Price"":421.24,""SellerId"":42,""BuyerId"":46},{""Name"":""Triamterene and Hydrochlorothiazide"",""Price"":1416.59,""SellerId"":2,""BuyerId"":32},{""Name"":""Ranitidine"",""Price"":926.64,""SellerId"":45,""BuyerId"":33},{""Name"":""Air"",""Price"":331.53,""SellerId"":45,""BuyerId"":38},{""Name"":""Metoprolol Tartrate"",""Price"":1405.74,""SellerId"":21,""BuyerId"":49},{""Name"":""Pioglitazone"",""Price"":306.56,""SellerId"":23,""BuyerId"":36},{""Name"":""Butalbital, Aspirin and Caffeine"",""Price"":1010.98,""SellerId"":43,""BuyerId"":41},{""Name"":""Hydralazine Hydrochloride"",""Price"":1309.72,""SellerId"":45,""BuyerId"":null},{""Name"":""Nevirapine"",""Price"":1374.72,""SellerId"":38,""BuyerId"":31},{""Name"":""ESIKA"",""Price"":879.37,""SellerId"":16,""BuyerId"":24},{""Name"":""Homeopathic Rheumatism"",""Price"":967.08,""SellerId"":38,""BuyerId"":16},{""Name"":""Amitriptyline Hydrochloride"",""Price"":1453.96,""SellerId"":17,""BuyerId"":51},{""Name"":""Ibuprofen"",""Price"":1305.96,""SellerId"":5,""BuyerId"":10},{""Name"":""Laser Block 100"",""Price"":1135.43,""SellerId"":35,""BuyerId"":7},{""Name"":""ANXIETY/STRESS RELIEF"",""Price"":324.66,""SellerId"":56,""BuyerId"":43},{""Name"":""TYLENOL COLD MULTI-SYMPTOM DAYTIME"",""Price"":1010.81,""SellerId"":17,""BuyerId"":26},{""Name"":""Naproxen"",""Price"":807.22,""SellerId"":7,""BuyerId"":17},{""Name"":""Dover Aminophen"",""Price"":192.07,""SellerId"":15,""BuyerId"":null},{""Name"":""DIPYRIDAMOLE"",""Price"":1150.67,""SellerId"":24,""BuyerId"":1},{""Name"":""Etodolac"",""Price"":1443.13,""SellerId"":8,""BuyerId"":44},{""Name"":""ziprasidone hydrochloride"",""Price"":628.66,""SellerId"":38,""BuyerId"":5},{""Name"":""Treatment Set TS336667"",""Price"":1466.47,""SellerId"":52,""BuyerId"":35},{""Name"":""Prostate"",""Price"":716.05,""SellerId"":9,""BuyerId"":13},{""Name"":""Acid Reducer"",""Price"":1443.51,""SellerId"":25,""BuyerId"":43},{""Name"":""leader pain reliever"",""Price"":1179.79,""SellerId"":46,""BuyerId"":2},{""Name"":""allergy eye"",""Price"":426.91,""SellerId"":16,""BuyerId"":1},{""Name"":""Yellow Jacket hymenoptera venom Venomil Diagnostic"",""Price"":23.58,""SellerId"":22,""BuyerId"":3},{""Name"":""Acetaminophen, Chlorpheniramine Maleate, Dextromethorphan Hydrobromide, Phenylephrine Hydrochloride"",""Price"":1028.27,""SellerId"":50,""BuyerId"":null}]";

        var usersJson =
     @"[{""firstName"":""Eugene"",""lastName"":""Stewart"",""age"":65},{""firstName"":""Fred"",""lastName"":""Allen"",""age"":57},{""firstName"":""Clarence"",""lastName"":""Fowler"",""age"":50},{""firstName"":""Betty"",""lastName"":""Lawson"",""age"":38},{""firstName"":""Anna"",""lastName"":""Clark"",""age"":41},{""firstName"":""Carl"",""lastName"":""Daniels"",""age"":59},{""firstName"":""Carl"",""lastName"":""Lawson"",""age"":19},{""firstName"":null,""lastName"":""Fox"",""age"":68},{""firstName"":""Gary"",""lastName"":""Stevens"",""age"":null},{""firstName"":null,""lastName"":""Mitchell"",""age"":41},{""firstName"":null,""lastName"":""Bennett"",""age"":null},{""firstName"":""Brenda"",""lastName"":""Howell"",""age"":75},{""firstName"":null,""lastName"":""Schmidt"",""age"":70},{""firstName"":""Brandon"",""lastName"":""Fuller"",""age"":30},{""firstName"":null,""lastName"":""Moreno"",""age"":37},{""firstName"":null,""lastName"":""Stewart"",""age"":39},{""firstName"":null,""lastName"":""Peterson"",""age"":72},{""firstName"":""Patrick"",""lastName"":""King"",""age"":null},{""firstName"":""Rachel"",""lastName"":""Johnson"",""age"":24},{""firstName"":""Sandra"",""lastName"":""Riley"",""age"":74},{""firstName"":""Gloria"",""lastName"":""Alexander"",""age"":61},{""firstName"":null,""lastName"":""Harrison"",""age"":""18""},{""firstName"":""Nicole"",""lastName"":""Harris"",""age"":43},{""firstName"":""Benjamin"",""lastName"":""Henry"",""age"":63},{""firstName"":""Nicole"",""lastName"":""Martinez"",""age"":28},{""firstName"":null,""lastName"":""Baker"",""age"":null},{""firstName"":""Patricia"",""lastName"":""Cooper"",""age"":72},{""firstName"":null,""lastName"":""Thompson"",""age"":46},{""firstName"":""Ann"",""lastName"":""Stevens"",""age"":null},{""firstName"":""Christina"",""lastName"":""Patterson"",""age"":63},{""firstName"":""Sarah"",""lastName"":""Day"",""age"":33},{""firstName"":""Jennifer"",""lastName"":""Riley"",""age"":null},{""firstName"":""Jacqueline"",""lastName"":""Perez"",""age"":25},{""firstName"":""Amanda"",""lastName"":""Frazier"",""age"":null},{""firstName"":""Joshua"",""lastName"":""Murray"",""age"":41},{""firstName"":""Jean"",""lastName"":""Henry"",""age"":null},{""firstName"":""Diana"",""lastName"":""Harvey"",""age"":46},{""firstName"":""Emily"",""lastName"":""Parker"",""age"":41},{""firstName"":""Paula"",""lastName"":""Hill"",""age"":74},{""firstName"":""Billy"",""lastName"":""Parker"",""age"":68},{""firstName"":""Jeremy"",""lastName"":""Woods"",""age"":20},{""firstName"":""Christine"",""lastName"":""Gomez"",""age"":28},{""firstName"":""Jonathan"",""lastName"":""Rodriguez"",""age"":null},{""firstName"":""Kathy"",""lastName"":""Gilbert"",""age"":51},{""firstName"":""Fred"",""lastName"":""Barnes"",""age"":null},{""firstName"":""Anna"",""lastName"":""Parker"",""age"":56},{""firstName"":""Betty"",""lastName"":""Ward"",""age"":70},{""firstName"":""Patricia"",""lastName"":""Fuller"",""age"":36},{""firstName"":""Bonnie"",""lastName"":""Fox"",""age"":18},{""firstName"":""Chris"",""lastName"":""Mitchell"",""age"":59},{""firstName"":null,""lastName"":""Cunningham"",""age"":null},{""firstName"":""Arthur"",""lastName"":""Reynolds"",""age"":32},{""firstName"":""Thomas"",""lastName"":""Snyder"",""age"":40},{""firstName"":""Marie"",""lastName"":""Williamson"",""age"":null},{""firstName"":""Wanda"",""lastName"":""Harris"",""age"":26},{""firstName"":""Doris"",""lastName"":""Cook"",""age"":61}]";


        var products = JsonConvert.DeserializeObject<List<Product>>(productsJson);
        var users = JsonConvert.DeserializeObject<List<User>>(usersJson);

        context.Users.AddRange(users);
        context.Products.AddRange(products);
        context.SaveChanges();
    }

    private static Type GetType(string modelName)
    {
        var modelType = CurrentAssembly
            .GetTypes()
            .FirstOrDefault(t => t.Name == modelName);

        Assert.IsNotNull(modelType, $"{modelName} model not found!");

        return modelType;
    }

    private static IServiceProvider ConfigureServices<TContext>(string databaseName)
        where TContext : DbContext
    {
        var services = ConfigureDbContext<TContext>(databaseName);

        var context = services.GetService<TContext>();

        try
        {
            context.Model.GetEntityTypes();
        }
        catch (InvalidOperationException ex) when (ex.Source == "Microsoft.EntityFrameworkCore.Proxies")
        {
            services = ConfigureDbContext<TContext>(databaseName, useLazyLoading: true);
        }

        return services;
    }

    private static IServiceProvider ConfigureDbContext<TContext>(string databaseName, bool useLazyLoading = false)
        where TContext : DbContext
    {
        var services = new ServiceCollection()
          .AddDbContext<TContext>(t => t
          .UseInMemoryDatabase(Guid.NewGuid().ToString())
          );

        var serviceProvider = services.BuildServiceProvider();
        return serviceProvider;
    }
}